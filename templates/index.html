<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ù–æ–≤–æ—Å—Ç–∏ (WebSocket)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; background: #f6f7f9; }
    h1 { margin: 0 0 12px; }
    #toolbar { margin: 0 0 16px; display: flex; gap: 8px; }
    #news { padding: 10px; background: #fff; border: 1px solid #ddd; max-width: 720px; }
    .item { padding: 8px 6px; border-bottom: 1px dashed #e5e7eb; }
    .muted { color: #6b7280; font-size: 12px; }
  </style>
</head>
<body>
  <h1>üì¢ –ù–æ–≤–æ—Å—Ç–∏</h1>
  <div id="toolbar">
    <button id="pingBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (ping)</button>
    <span id="status" class="muted">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ‚Ä¶</span>
  </div>
  <div id="news"></div>

  <script>
    const newsDiv = document.getElementById("news");
    const statusEl = document.getElementById("status");
    const ws = new WebSocket((location.protocol === 'https:' ? 'wss://' : 'ws://') + location.host + "/ws");

    ws.onopen = () => {
      statusEl.textContent = "‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ";
      // –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π ping —Ä–∞–∑ –≤ 10 —Å–µ–∫—É–Ω–¥
      setInterval(() => ws.readyState === WebSocket.OPEN && ws.send("ping"), 10000);
    };

    ws.onmessage = (event) => {
      const msg = event.data;
      if (msg === "pong") {
        statusEl.textContent = "üíì –û—Ç–≤–µ—Ç –Ω–∞ ping –ø–æ–ª—É—á–µ–Ω";
        setTimeout(() => statusEl.textContent = "‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ", 1500);
        return;
      }
      const div = document.createElement("div");
      div.className = "item";
      div.textContent = msg;
      newsDiv.prepend(div);
    };

    ws.onclose = () => { statusEl.textContent = "‚ùå –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ"; };
    ws.onerror = () => { statusEl.textContent = "‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"; };

    document.getElementById("pingBtn").onclick = () => {
      if (ws.readyState === WebSocket.OPEN) ws.send("ping");
    };
  </script>
</body>
</html>
